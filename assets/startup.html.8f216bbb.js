import{_ as p,r as t,o as c,c as i,b as l,d as e,w as a,a as o,e as s}from"./app.6f19168f.js";const r={},D=o(`<h1 id="application-configuration" tabindex="-1"><a class="header-anchor" href="#application-configuration" aria-hidden="true">#</a> Application Configuration</h1><p>In order for Coalesce to work in your application, you must register the needed services in your <code>Startup.cs</code> file. Doing so is simple:</p><div class="language-c# ext-c# line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">ConfigureServices</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">IServiceCollection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">services</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">services</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AddCoalesce</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt;();</span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This registers all the basic services that Coalesce needs in order to work with your EF DbContext. However, there are many more options available. Here&#39;s a more complete invocation of <code>AddCoalesce</code> that takes advantage of many of the options available:</p><div class="language-c# ext-c# line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">ConfigureServices</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">IServiceCollection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">services</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">services</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AddCoalesce</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;"> =&gt; </span><span style="color:#9CDCFE;">builder</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">AddContext</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt;()</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">UseDefaultDataSource</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">MyDataSource</span><span style="color:#D4D4D4;">&lt;,&gt;))</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">UseDefaultBehaviors</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">typeof</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">MyBehaviors</span><span style="color:#D4D4D4;">&lt;,&gt;))</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">UseTimeZone</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">TimeZoneInfo</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">FindSystemTimeZoneById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Pacific Standard Time&quot;</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">Configure</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">o</span><span style="color:#D4D4D4;"> =&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">        {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">o</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">DetailedExceptionMessages</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">o</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ExceptionResponseFactory</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;"> =&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">            {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">FileNotFoundException</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">                {</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">HttpContext</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Response</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">StatusCode</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">404</span><span style="color:#D4D4D4;">; </span><span style="color:#6A9955;">// Optional - set a specific response code.</span></span>
<span class="line"><span style="color:#D4D4D4;">                    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">IntelliTect</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Coalesce</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">Models</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">ApiResult</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;File not found&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">                }</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            };</span></span>
<span class="line"><span style="color:#D4D4D4;">        });</span></span>
<span class="line"><span style="color:#D4D4D4;">    );</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A summary is as follows:</p><p><code>.AddContext&lt;AppDbContext&gt;()</code></p><p>Register services needed by Coalesce to use the specified context. This is done automatically when calling the <code>services.AddCoalesce&lt;AppDbContext&gt;();</code> overload.</p><p><code>.UseDefaultDataSource(typeof(MyDataSource&lt;,&gt;))</code></p>`,9),d=s("Overrides the default data source used, replacing the "),y=s("Standard Data Source"),u=s(". See "),v=s("Data Sources"),C=s(" for more details."),m=l("p",null,[l("code",null,".UseDefaultBehaviors(typeof(MyBehaviors<,>))")],-1),h=s("Overrides the default behaviors used, replacing the "),b=s("Standard Behaviors"),E=s(". See "),A=s("Behaviors"),g=s(" for more details."),f=o(`<p><code>.UseTimeZone(TimeZoneInfo.FindSystemTimeZoneById(&quot;Pacific Standard Time&quot;))</code></p><p>Specify a static time zone that should be used when Coalesce is performing operations on dates/times that lack timezone information. For example, when a user inputs a search term that contains only a date, Coalesce needs to know what timezone&#39;s midnight to use when performing the search.</p><p><code>.UseTimeZone&lt;ITimeZoneResolver&gt;()</code></p><p>Specify a service implementation to use to resolve the current timezone. This should be a scoped service, and will be automatically registered if it is not already. This allows retrieving timezone information on a per-request basis from HTTP headers, Cookies, or any other source.</p><p><code>.Configure(...)</code></p><p>Configure additional options for Coalesce runtime behavior. Current options include those around exception handling. See individual members for details.</p><h2 id="security-overview-page" tabindex="-1"><a class="header-anchor" href="#security-overview-page" aria-hidden="true">#</a> Security Overview Page</h2><p>Coalesce provides batteries-included page that you can view to review the security rules in place for all the Coalesce-generated code in your project. Add this page to your application by mapping it as a route, either directly on <code>WebHost</code> in .NET 6+, or in <code>UseEndpoints</code> for 3.1+.</p><div class="language-c# ext-c# line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// .NET 6 Program.cs:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// If exposing in production, it is strongly encourage to apply an authorization policy like this one.</span></span>
<span class="line"><span style="color:#6A9955;">// Alternative, make the entire endpoint conditional upon the environment.</span></span>
<span class="line"><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MapCoalesceSecurityOverview</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;coalesce-security&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">RequireAuthorization</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">AuthorizeAttribute</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">Roles</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">IsDevelopment</span><span style="color:#D4D4D4;">() ? </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> : </span><span style="color:#CE9178;">&quot;Admin&quot;</span><span style="color:#D4D4D4;"> }</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c# ext-c# line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// .NET 3.1+ Startup.cs:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">UseEndpoints</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">endpoints</span><span style="color:#D4D4D4;"> =&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// If exposing in production, it is strongly encourage to apply an authorization policy like this one.</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Alternative, make the entire endpoint conditional upon the environment.</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">endpoints</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">MapCoalesceSecurityOverview</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;coalesce-security&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">RequireAuthorization</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">AuthorizeAttribute</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">Roles</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">IsDevelopment</span><span style="color:#D4D4D4;">() ? </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> : </span><span style="color:#CE9178;">&quot;Admin&quot;</span><span style="color:#D4D4D4;"> }</span></span>
<span class="line"><span style="color:#D4D4D4;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// ... Other endpoints</span></span>
<span class="line"><span style="color:#D4D4D4;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10);function _(F,x){const n=t("RouterLink");return c(),i("div",null,[D,l("p",null,[d,e(n,{to:"/modeling/model-components/data-sources.html#standard-data-source"},{default:a(()=>[y]),_:1}),u,e(n,{to:"/modeling/model-components/data-sources.html"},{default:a(()=>[v]),_:1}),C]),m,l("p",null,[h,e(n,{to:"/modeling/model-components/behaviors.html#standard-behaviors"},{default:a(()=>[b]),_:1}),E,e(n,{to:"/modeling/model-components/behaviors.html"},{default:a(()=>[A]),_:1}),g]),f])}var w=p(r,[["render",_],["__file","startup.html.vue"]]);export{w as default};
